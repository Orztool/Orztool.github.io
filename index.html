<!DOCTYPE html>
<html>

<title>一键生成orzRatingCode</title>

<head>
    <script>console.log("啊！被你发现我了Σ( ° △ °|||)︴\n你怎么打开了控制台啊，\n本人js新人，千万不要看我的代码，写的很烂ww");</script>
    <h1 align="left">
        <font color="blue"  size="7">OrzTools</font>
    </h1>
    <h1 align="left">
        <font color="red"  size="2">（ver1.0.0，上次更新于20230813）</font>
    </h1>
    
    
    
    
    <p style="font-size: 20px">这是一个Orzmic Rating计算器的配套工具，</p>


    <p style="font-size: 20px">用于将RatingCode中的文本转化为csv格式:</p>

    <p style="font-size: 20px">请输入你的二维码中获取的所有内容</p>
    
    <a href="https://cli.im/deqr/">点击在线解析二维码</a>
    <br><br><br>
    <input type="text" id="code" name="code" style="width:500px; height:40px;" />



    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="author" content="">

    <script>



        function exportCsv(obj) {
            var str = [];
            str.push("Ver,");//新建栏目Ver并且插入它的值
            str.push(obj.Ver+ "\n");
            str.push("Name,");//新建栏目Name并且插入它的值
            str.push(obj.Name+ "\n");
            str.push("Coin,");//新建栏目Coin并且插入它的值
            str.push(obj.Coin+ "\n");
            str.push("CharID,");//新建栏目CharID并且插入它的值
            str.push(obj.CharID+ "\n");
            str.push("CharSkinID,");//新建栏目CharSkinID并且插入它的值
            str.push(obj.CharSkinID+ "\n");
            var titleForCLU = Object.keys(obj.CharUnlock[0]);
            var charUnlock = obj.CharUnlock;
            str.push("CharUnlock,");//给这一栏命名
            for (var i = 0; i < charUnlock.length; i++) {
                var temp = [];
                for (var j = 0; j < titleForCLU.length; j++) {
                    temp.push(charUnlock[i][titleForCLU[j]]);
                }
                str.push(temp.join(",") + "\n");
            }//按顺序插入CharUnlock里面的逐个数值
            str.push("Rat,");//新建栏目rat并且插入它的值
            str.push(obj.Rat+ "\n");
            str.push("SPRat,");//新建栏目SPRat并且插入它的值
            str.push(obj.SPRat+ "\n");
            str.push("Prog,");//新建栏目SPRat并且插入它的值
            str.push(obj.Prog+ "\n");
            str.push("SPScores,");//新建栏目SPScores并且插入它的值
            str.push(obj.SPScores+ "\n");
            str.push("B20Scores,");//新建栏目B20Scores并且插入它的值
            str.push(obj.B20Scores+ "\n");
            
            var blob = new Blob(['\uFEFF' + str.join('')], {
                type: 'text/plain;charset=utf-8',
            });
            
            var downloadLink = document.createElement("a");
            downloadLink.href = URL.createObjectURL(blob);
            downloadLink.download = "export.csv";//最后下载这个文件
            downloadLink.click();
        }
        function downloadCSV() {
            //获取 输入框的值，点击按钮就触发
            try {
                //使用try在出错时自动抛出错误
                var json = document.getElementById("code").value;
                var jsonobj = JSON.parse(json);
                //将输入框的值作为json读取
                
                
                var jsonin = {
                    Ver:jsonobj.Ver,
                    Name:jsonobj.Name,
                    Coin:jsonobj.Coin,
                    CharID:jsonobj.CharID,
                    CharSkinID:jsonobj.CharSkinID,
                    CharUnlock: [
                        {
                            table0: jsonobj.CharUnlock.charAt(0),
                            table1: jsonobj.CharUnlock.charAt(1),
                            table2: jsonobj.CharUnlock.charAt(2),
                            table3: jsonobj.CharUnlock.charAt(3),
                            table4: jsonobj.CharUnlock.charAt(4),
                            table5: jsonobj.CharUnlock.charAt(5),
                            table6: jsonobj.CharUnlock.charAt(6),
                            table7: jsonobj.CharUnlock.charAt(7),
                            table8: jsonobj.CharUnlock.charAt(8),
                            table9: jsonobj.CharUnlock.charAt(9),
                            table10: jsonobj.CharUnlock.charAt(10),
                            table11: jsonobj.CharUnlock.charAt(11),
                            table12: jsonobj.CharUnlock.charAt(12),
                            table13: jsonobj.CharUnlock.charAt(13),
                            table14: jsonobj.CharUnlock.charAt(14),
                            table15: jsonobj.CharUnlock.charAt(15),
                            table16: jsonobj.CharUnlock.charAt(16),
                            table17: jsonobj.CharUnlock.charAt(17),
                            table18: jsonobj.CharUnlock.charAt(18),
                            table19: jsonobj.CharUnlock.charAt(19),
                        }
                    ],
                    Rat:jsonobj.Rat,
                    SPRat:jsonobj.SPRat,
                    Prog:jsonobj.Prog,
                    B20Scores:jsonobj.B20Scores,
                    SPScores:jsonobj.SPScores
                }

                exportCsv(jsonin);//把json数据传给导出csv的函数
            } catch (error) {
                alert("出问题了捏，可能是输入的内容不正确/复制的内容不完整");
                console.log("有人输入了无效的信息我不说是谁");
                //在错误发生时怎么处理

            }

        }
        window.onload = function () {
            document.getElementById("downloadcsv").onclick = function () {
                downloadCSV();

            }
        }
    </script>
</head>

<body>
    <br>
    <button style="width:100px; height:50px; font-size: 30px" id="downloadcsv" href="javascript:;">导出</button>
    <br>
    （如果点击后没有提示下载CSV文件，请更新你的浏览器版本）
    <br>
    （请不要在QQ/微信内置的浏览器打开！会导致异常错误）
    <br>
    （如果你是来获取bot需要的信息，你只需要解析完二维码就行了！不需要导出csv！也不需要输入到框框）
    
    <br><br>
    作者：
    <a href="https://space.bilibili.com/1333478733">B站@Daniel-lin-</a>
    <br>
    Q Q： <a href="https://qm.qq.com/q/klUucQlRPU">@2370408621</a>
    <br><br>
    鸣谢：
    <br>
    
    <a href="https://space.bilibili.com/518645556">B站@思昔不咕咕</a>提供的OrzmicRatingCode内容破译 (<a href="https://www.bilibili.com/read/cv21504654">查看原理</a>)
    <br>
    <a href="https://space.bilibili.com/550984227">B站@Star沐染</a>提供的Python算法思路，给了我很大的启发。
</body>

</html>